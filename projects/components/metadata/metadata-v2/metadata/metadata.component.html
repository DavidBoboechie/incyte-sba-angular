<ng-container *ngIf="display">
    <!-- Icon -->
    <span *ngIf="showIcon" class="sq-metadata-col {{config.icon}} pe-1"></span>

    <!-- Title -->
    <span *ngIf="showTitle" class="sq-metadata-col sq-metadata-item-label pe-1">
        {{'msg#metadata.item.label' | sqMessage:itemLabelMessageParams}}
    </span>

    <!-- Value -->
    <div class="sq-metadata-col" [style.max-height.px]="valuesHeight" [class.collapsable]="valuesHeight" #values>
        <!-- Collapse button -->
        <a *ngIf="collapseRows && needsCollapse" role="button" (click)="toggleCollapse()" class="collapse-button me-1">
            <i class="fas fa-fw fa-caret-{{collapsed? 'right' : 'down'}}"></i>
        </a>

        <!-- Access list metadata -->
        <sq-metadata-access-lists-item *ngIf="isAccessLists; else default" [accessLists]="accessListsData">
        </sq-metadata-access-lists-item>

        <!-- Other types of metadata -->
        <ng-template #default>
            <ng-container *ngIf="config.isTree; else isNotTree">
                <sq-metadata-tree [record]="record" [config]="config" [query]="query" [clickable]="isClickable"
                    [column]="config.column" [showFiltersHighlights]="showFiltersHighlights" [loading]="loading"
                    [entityTemplate]="entityTemplate" [actions]="actions" [actionsButtonsStyle]="actionsButtonsStyle"
                    [actionsButtonsSize]="actionsButtonsSize" [tooltipLinesNumber]="tooltipLinesNumber"
                    (openedPopper)="currentItem=$event"></sq-metadata-tree>
            </ng-container>

            <!-- Not a Tree-->
            <ng-template #isNotTree>
                <div *ngIf="editLabels" class="row">
                    <div class="col-10">
                        <sq-labels-autocomplete [initLabels]="labels" [allowNewLabels]="true"
                            (labelsUpdate)="labelsUpdate($event)"></sq-labels-autocomplete>
                    </div>
                    <div class="col-2 p-0">
                        <button class="btn btn-primary"><span class="fas fa-save"></span></button>
                        <button class="btn btn-secondary mx-1" (click)="editLabels=false"><span
                                class="fas fa-times"></span></button>
                    </div>
                </div>

                <span *ngFor="let valueItem of config.valueItems; let $index = index"
                    class="sq-metadata-item {{'sq-metadata-item-' + config.item}} {{config.itemClass}}"
                    [attr.title]="(showTitle || config.entityTooltip) ? null : (label | sqMessage)" sqPopper
                    [target]="isClickable && actions?.length ? tooltip : undefined" [placement]="placement"
                    [hidden]="editLabels" (shown)="openedPopper(valueItem)"
                    [style.background-color]="showFiltersHighlights && valueItem.filtered ? 'yellow': showFiltersHighlights && valueItem.excluded ? 'red' : 'transparent'">
                    <span class="badge rounded-pill">
                        <span *ngIf="showFormatIcons && valueIcon" class="{{valueIcon}}"></span>
                        {{valueItem | sqValue:config.column}}
                    </span>

                    <div #tooltip [hidden]="!actions?.length">
                        <sq-metadata-tooltip [loading]="loading" [entityTemplate]="entityTemplate" [actions]="actions"
                            [actionsButtonsStyle]="actionsButtonsStyle" [actionsButtonsSize]="actionsButtonsSize"
                            [tooltipLinesNumber]="tooltipLinesNumber"></sq-metadata-tooltip>
                    </div>
                </span>
            </ng-template>
        </ng-template>
    </div>
</ng-container>