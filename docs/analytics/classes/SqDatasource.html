<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Analytics</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">Analytics</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content class">
                   <div class="content-data">











<ol class="breadcrumb">
  <li>Classes</li>
  <li >SqDatasource</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>ag-grid/datasource.ts</code>
        </p>




            <p class="comment">
                <h3>Implements</h3>
            </p>
            <p class="comment">
                        <code>IDatasource</code>
            </p>


            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#_destroyedFlag" >_destroyedFlag</a>
                            </li>
                            <li>
                                <a href="#_filterChangedFlag" >_filterChangedFlag</a>
                            </li>
                            <li>
                                <a href="#_sortChangedFlag" >_sortChangedFlag</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#appService" >appService</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#colDefs" >colDefs</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#facetService" >facetService</a>
                            </li>
                            <li>
                                <a href="#latestResults" >latestResults</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#query" >query</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#results" >results</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#searchService" >searchService</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#selectionService" >selectionService</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#applyFilter" >applyFilter</a>
                            </li>
                            <li>
                                <a href="#applySort" >applySort</a>
                            </li>
                            <li>
                                <a href="#destroy" >destroy</a>
                            </li>
                            <li>
                                    <span class="modifier">Static</span>
                                <a href="#exprToModel" >exprToModel</a>
                            </li>
                            <li>
                                <a href="#filterChanged" >filterChanged</a>
                            </li>
                            <li>
                                <a href="#getRows" >getRows</a>
                            </li>
                            <li>
                                    <span class="modifier">Static</span>
                                <a href="#makeExpr" >makeExpr</a>
                            </li>
                            <li>
                                <a href="#makeSort" >makeSort</a>
                            </li>
                            <li>
                                    <span class="modifier">Static</span>
                                <a href="#modelToExpr" >modelToExpr</a>
                            </li>
                            <li>
                                <a href="#sortChanged" >sortChanged</a>
                            </li>
                            <li>
                                    <span class="modifier">Static</span>
                                <a href="#subExprToModel" >subExprToModel</a>
                            </li>
                            <li>
                                <a href="#updateGlobalFilters" >updateGlobalFilters</a>
                            </li>
                            <li>
                                <a href="#updateGlobalSort" >updateGlobalSort</a>
                            </li>
                        </ul>
                    </td>
                </tr>





                    <tr>
                        <td class="col-md-4">
                            <h6><b>Accessors</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                    <a href="#rowCount" >rowCount</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(results: Results, query: Query | undefined, colDefs: ColDef[], searchService: SearchService, appService: AppService, facetService: FacetService, selectionService: SelectionService)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="30" class="link-to-prism">ag-grid/datasource.ts:30</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>results</td>
                                                  
                                                        <td>
                                                                    <code>Results</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>query</td>
                                                  
                                                        <td>
                                                                    <code>Query | undefined</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>colDefs</td>
                                                  
                                                        <td>
                                                                    <code>ColDef[]</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>searchService</td>
                                                  
                                                        <td>
                                                                    <code>SearchService</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>appService</td>
                                                  
                                                        <td>
                                                                    <code>AppService</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>facetService</td>
                                                  
                                                        <td>
                                                                    <code>FacetService</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>selectionService</td>
                                                  
                                                        <td>
                                                                    <code>SelectionService</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_destroyedFlag"></a>
                    <span class="name">
                        <span ><b>_destroyedFlag</b></span>
                        <a href="#_destroyedFlag"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="25" class="link-to-prism">ag-grid/datasource.ts:25</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_filterChangedFlag"></a>
                    <span class="name">
                        <span ><b>_filterChangedFlag</b></span>
                        <a href="#_filterChangedFlag"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="23" class="link-to-prism">ag-grid/datasource.ts:23</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_sortChangedFlag"></a>
                    <span class="name">
                        <span ><b>_sortChangedFlag</b></span>
                        <a href="#_sortChangedFlag"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="24" class="link-to-prism">ag-grid/datasource.ts:24</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="appService"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>appService</b></span>
                        <a href="#appService"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>AppService</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="37" class="link-to-prism">ag-grid/datasource.ts:37</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="colDefs"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>colDefs</b></span>
                        <a href="#colDefs"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>ColDef[]</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="35" class="link-to-prism">ag-grid/datasource.ts:35</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="facetService"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>facetService</b></span>
                        <a href="#facetService"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>FacetService</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="38" class="link-to-prism">ag-grid/datasource.ts:38</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="latestResults"></a>
                    <span class="name">
                        <span ><b>latestResults</b></span>
                        <a href="#latestResults"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>Results</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="21" class="link-to-prism">ag-grid/datasource.ts:21</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="query"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>query</b></span>
                        <a href="#query"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>Query | undefined</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="34" class="link-to-prism">ag-grid/datasource.ts:34</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="results"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>results</b></span>
                        <a href="#results"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>Results</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="33" class="link-to-prism">ag-grid/datasource.ts:33</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="searchService"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>searchService</b></span>
                        <a href="#searchService"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>SearchService</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="36" class="link-to-prism">ag-grid/datasource.ts:36</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="selectionService"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>selectionService</b></span>
                        <a href="#selectionService"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>SelectionService</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="39" class="link-to-prism">ag-grid/datasource.ts:39</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="applyFilter"></a>
                    <span class="name">
                        <span ><b>applyFilter</b></span>
                        <a href="#applyFilter"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>applyFilter(query: <a href="https://angular.io/api/core/Query" target="_blank">Query</a>, filter: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>, column: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="196"
                            class="link-to-prism">ag-grid/datasource.ts:196</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Apply an ag-grid filter to a Sinequa query.
The filter model is first converted into a Sinequa Expr, and
then the select is added to the query</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>query</td>
                                    <td>
                                                <code><a href="https://angular.io/api/core/Query" target="_blank" >Query</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>filter</td>
                                    <td>
                                                <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>column</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="applySort"></a>
                    <span class="name">
                        <span ><b>applySort</b></span>
                        <a href="#applySort"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>applySort(query: <a href="https://angular.io/api/core/Query" target="_blank">Query</a>, model: literal type | undefined)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="206"
                            class="link-to-prism">ag-grid/datasource.ts:206</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Apply an ag-grid sort to a Sinequa query (orderBy property).</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>query</td>
                                    <td>
                                                <code><a href="https://angular.io/api/core/Query" target="_blank" >Query</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>model</td>
                                    <td>
                                            <code>literal type | undefined</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="destroy"></a>
                    <span class="name">
                        <span ><b>destroy</b></span>
                        <a href="#destroy"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>destroy()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="170"
                            class="link-to-prism">ag-grid/datasource.ts:170</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="exprToModel"></a>
                    <span class="name">
                        <span class="modifier">Static</span>
                        <span ><b>exprToModel</b></span>
                        <a href="#exprToModel"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>exprToModel(type: "text" | "number" | "date", column: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, expr: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="304"
                            class="link-to-prism">ag-grid/datasource.ts:304</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Convert an expression generated by makeExpr() back into
a model that ag-grid can understand</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>type</td>
                                    <td>
                                            <code>&quot;text&quot; | &quot;number&quot; | &quot;date&quot;</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>column</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>expr</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="filterChanged"></a>
                    <span class="name">
                        <span ><b>filterChanged</b></span>
                        <a href="#filterChanged"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>filterChanged()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="177"
                            class="link-to-prism">ag-grid/datasource.ts:177</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Notify this datasource that a filter was changed by a user</p>
</div>

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getRows"></a>
                    <span class="name">
                        <span ><b>getRows</b></span>
                        <a href="#getRows"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getRows(params: IGetRowsParams)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="53"
                            class="link-to-prism">ag-grid/datasource.ts:53</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>This method is called by ag-grid in different situations:</p>
<ul>
<li>The datasource is created and data needs to be displayed</li>
<li>The user scrolls down and the grid needs to display more rows</li>
<li>The user changes an ag-grid filter (filterModel)</li>
<li>The user changes an ag-grid sort (sortModel)</li>
</ul>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>params</td>
                                    <td>
                                            <code>IGetRowsParams</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="makeExpr"></a>
                    <span class="name">
                        <span class="modifier">Static</span>
                        <span ><b>makeExpr</b></span>
                        <a href="#makeExpr"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>makeExpr(filter: <a href="../undefineds/Filter.html" target="_self">Filter</a>, column: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, normalize?: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank">boolean</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="257"
                            class="link-to-prism">ag-grid/datasource.ts:257</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Utility function to convert an ag-grid filter into an
equivalent fielded-search string.</p>
<p>For example a filter of type &quot;contains&quot; on the string &quot;toto&quot;
is converted to the query &quot;~ toto&quot;</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>filter</td>
                                    <td>
                                                <code><a href="../miscellaneous/typealiases.html#Filter" target="_self" >Filter</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>column</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>normalize</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="makeSort"></a>
                    <span class="name">
                        <span ><b>makeSort</b></span>
                        <a href="#makeSort"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>makeSort(model: literal type | undefined)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="220"
                            class="link-to-prism">ag-grid/datasource.ts:220</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Transform an ag-grid sort into a Sinequa order by clause</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>model</td>
                                    <td>
                                            <code>literal type | undefined</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>string | undefined</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="modelToExpr"></a>
                    <span class="name">
                        <span class="modifier">Static</span>
                        <span ><b>modelToExpr</b></span>
                        <a href="#modelToExpr"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>modelToExpr(model: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>, column: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, normalize?: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank">boolean</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="241"
                            class="link-to-prism">ag-grid/datasource.ts:241</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Transforms a filter model into an expression</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>model</td>
                                    <td>
                                                <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>column</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>normalize</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="sortChanged"></a>
                    <span class="name">
                        <span ><b>sortChanged</b></span>
                        <a href="#sortChanged"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>sortChanged()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="184"
                            class="link-to-prism">ag-grid/datasource.ts:184</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Notify this datasource that a sort was changed by a user</p>
</div>

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="subExprToModel"></a>
                    <span class="name">
                        <span class="modifier">Static</span>
                        <span ><b>subExprToModel</b></span>
                        <a href="#subExprToModel"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>subExprToModel(type: "text" | "number" | "date", expr: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="324"
                            class="link-to-prism">ag-grid/datasource.ts:324</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>type</td>
                                    <td>
                                            <code>&quot;text&quot; | &quot;number&quot; | &quot;date&quot;</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>expr</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateGlobalFilters"></a>
                    <span class="name">
                        <span ><b>updateGlobalFilters</b></span>
                        <a href="#updateGlobalFilters"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>updateGlobalFilters(filterModel: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="145"
                            class="link-to-prism">ag-grid/datasource.ts:145</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Sync the ag-grid filter model with the global query</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>filterModel</td>
                                    <td>
                                                <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateGlobalSort"></a>
                    <span class="name">
                        <span ><b>updateGlobalSort</b></span>
                        <a href="#updateGlobalSort"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>updateGlobalSort(sortModel: literal type | undefined)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="161"
                            class="link-to-prism">ag-grid/datasource.ts:161</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Sync the ag-grid sort model with the global query</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>sortModel</td>
                                    <td>
                                            <code>literal type | undefined</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>





            <section>
    <h3 id="accessors">
        Accessors
    </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="rowCount"></a>
                        <span class="name"><b>rowCount</b><a href="#rowCount"><span class="icon ion-ios-link"></span></a></span>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>get</b><code>rowCount()</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="28" class="link-to-prism">ag-grid/datasource.ts:28</a></div>
                                </td>
                            </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>Number of rows on the server</p>
</div>

                                <div class="io-description">
                                    <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                </div>
                        </td>
                    </tr>

            </tbody>
        </table>
</section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { FacetService } from &#x27;@sinequa/components/facet&#x27;;
import { SearchService } from &#x27;@sinequa/components/search&#x27;;
import { SelectionService } from &#x27;@sinequa/components/selection&#x27;;
import { AppService, ExprParser, Query } from &#x27;@sinequa/core/app-utils&#x27;;
import { Utils } from &#x27;@sinequa/core/base&#x27;;
import { Results } from &#x27;@sinequa/core/web-services&#x27;;
import { IGetRowsParams, IDatasource, ColDef } from &#x27;ag-grid-community&#x27;;

export type Filter &#x3D; {
    filterType: &quot;text&quot; | &quot;number&quot; | &quot;date&quot;;
    type: &quot;contains&quot; | &quot;notContains&quot; | &quot;equals&quot; | &quot;notEqual&quot; | &quot;startsWith&quot; | &quot;endsWith&quot; | &quot;lessThan&quot; | &quot;lessThanOrEqual&quot; | &quot;greaterThan&quot; | &quot;greaterThanOrEqual&quot; | &quot;inRange&quot;;
    filter: string | number;
    filterTo?: number;
    dateFrom?: string;
    dateTo?: string;
};

export class SqDatasource implements IDatasource {

    // The latest results (as opposed to the &quot;seed&quot; results provided when building the datasource)
    latestResults: Results;

    _filterChangedFlag: boolean;
    _sortChangedFlag: boolean;
    _destroyedFlag: boolean;

    /** Number of rows on the server */
    get rowCount(): number {
        return this.latestResults.totalRowCount;
    }

    constructor(
        public results: Results,
        public query: Query | undefined,
        public colDefs: ColDef[],
        public searchService: SearchService,
        public appService: AppService,
        public facetService: FacetService,
        public selectionService: SelectionService
    ){
        this.latestResults &#x3D; results;
    }

    /**
     * This method is called by ag-grid in different situations:
     * - The datasource is created and data needs to be displayed
     * - The user scrolls down and the grid needs to display more rows
     * - The user changes an ag-grid filter (filterModel)
     * - The user changes an ag-grid sort (sortModel)
     * @param params 
     * @returns 
     */
    getRows(params: IGetRowsParams): void {

        if(this._destroyedFlag) {
            console.warn(&quot;Request cancelled&quot;);
            return;
        }

        // GLOBAL QUERY MODE (&quot;stateful&quot;): Filtering &amp; Sorting are managed globally by the search service and the state is stored in the URL and persisted upon refresh
        // Search bar, filters, etc. modify searchService.results, which results in a new datasource being created

        if(!this.query) {
            if(this._filterChangedFlag) {
                this.updateGlobalFilters(params.filterModel);
                this._destroyedFlag &#x3D; true; // We want to cancel any further request from ag-grid, as a new datasource will be created
                return;
            }
    
            if(this._sortChangedFlag) {
                if(this.updateGlobalSort(params.sortModel[0])) {
                    this._destroyedFlag &#x3D; true; // We want to cancel any further request from ag-grid, as a new datasource will be created
                    return;
                }
            }
            
            // Return the seed results if this is the first page
            if(params.startRow &#x3D;&#x3D;&#x3D; 0) {
                params.successCallback(this.results.records || [], this.rowCount);
            }
            // Or else, create a Query that fetches the data from the server
            else {
                const query &#x3D; this.searchService.query.copy();
                const pageSize &#x3D; this.appService.ccquery?.pageSize || 20;
                query.page &#x3D; 1 + (params.startRow / pageSize);

                // Query the server for data
                this.searchService.getResults(query).subscribe(results &#x3D;&gt; {
                    this.latestResults &#x3D; results;
                    const selected &#x3D; new Set(this.selectionService.getSelectedIds());
                    results.records.forEach(r &#x3D;&gt; r.$selected &#x3D; selected.has(r.id));
                    params.successCallback(results.records || [], this.rowCount);
                },
                err &#x3D;&gt; {
                    console.error(err);
                    params.failCallback();
                });
            }
        }

        // INTERNAL QUERY MODE (&quot;stateless&quot;): Filtering &amp; Sorting are managed internally by this datasource, but the state is lost upon refresh.
        // /!\ External facets and search bars will not work unless a new datasource is created
        // /!\ This mode is not compatible when using Sinequa facets in the grid (because facets are tied to the search service)

        else {

            // Return the seed results if there is no custom sorting, filtering or pagination required
            if(params.startRow &#x3D;&#x3D;&#x3D; 0 &amp;&amp; params.sortModel.length &#x3D;&#x3D;&#x3D; 0 &amp;&amp; Object.keys(params.filterModel).length &#x3D;&#x3D;&#x3D; 0) {
                params.successCallback(this.results.records || [], this.rowCount);
            }

            else {
                const query &#x3D; this.query.copy();
                const pageSize &#x3D; this.appService.ccquery?.pageSize || 20;
                query.page &#x3D; 1 + (params.startRow / pageSize);
    
                // Apply sorting (order by clause)
                if(params.sortModel.length &gt; 0) {
                    this.applySort(query, params.sortModel[0]);
                }
    
                // Filters are applied as a delta vs original query
                for(let column of Object.keys(params.filterModel)) {
                    this.applyFilter(query, params.filterModel[column], column);
                }
    
                // Query the server for data
                this.searchService.getResults(query).subscribe(results &#x3D;&gt; {
                    this.latestResults &#x3D; results;
                    params.successCallback(results.records || [], this.rowCount);
                },
                err &#x3D;&gt; {
                    console.error(err);
                    params.failCallback();
                });
            }
        }

    }

    /**
     * Sync the ag-grid filter model with the global query
     * @param filterModel 
     */
    updateGlobalFilters(filterModel: any) {
        for(let col of this.colDefs) {
            if(col.field &amp;&amp; col.filter &amp;&amp; col.filter !&#x3D;&#x3D; &quot;facet&quot;) { // Only manage ag-grid facets
                this.searchService.query.removeSelect(&quot;grid-filter-&quot;+col.field); // Remove existing filters if any
                if(filterModel[col.field]) {
                    this.applyFilter(this.searchService.query, filterModel[col.field], col.field);
                }
            }
        }
        this.searchService.search();
    }
    
    /**
     * Sync the ag-grid sort model with the global query
     * @param filterModel 
     */
    updateGlobalSort(sortModel: {colId: string, sort: string} | undefined): boolean {
        if(this.makeSort(sortModel) !&#x3D;&#x3D; this.searchService.query.orderBy){
            this.applySort(this.searchService.query, sortModel);
            this.searchService.search();
            return true;
        }
        return false;
    }

    destroy(): void {
        this._destroyedFlag &#x3D; true;
    }

    /**
     * Notify this datasource that a filter was changed by a user
     */
    filterChanged() {
        this._filterChangedFlag &#x3D; true;
    }

    /**
     * Notify this datasource that a sort was changed by a user
     */
    sortChanged() {
        this._sortChangedFlag &#x3D; true;
    }

    /**
     * Apply an ag-grid filter to a Sinequa query.
     * The filter model is first converted into a Sinequa Expr, and
     * then the select is added to the query
     * @param query 
     * @param filter 
     * @param column 
     */
    applyFilter(query: Query, filter: any, column: string) {
        const expr &#x3D; SqDatasource.modelToExpr(filter, column, this.appService.isEntity(column));
        query.addSelect(expr, &quot;grid-filter-&quot;+column);
    }

    /**
     * Apply an ag-grid sort to a Sinequa query (orderBy property).
     * @param query 
     * @param model 
     */
    applySort(query: Query, model: {colId: string, sort: string} | undefined) {
        if(model) {
            query.orderBy &#x3D; this.makeSort(model);
        }
        else {
            delete query.orderBy;
        }
    }

    /**
     * Transform an ag-grid sort into a Sinequa order by clause
     * @param model 
     * @returns 
     */
    makeSort(model: {colId: string, sort: string} | undefined): string | undefined {
        if(model) {
            let column &#x3D; model.colId; // geo
            const sort &#x3D; model.sort; // asc
            column &#x3D; this.appService.getColumn(column)?.name || column; // entity27
            return &#x60;${column} ${sort}&#x60;;
        }
        return undefined;
    }

    
    // STATIC METHODS
    // Conversions from Sinequa Expressions to AG Grid filters, and vice-versa

    /**
     * Transforms a filter model into an expression
     * @param column 
     * @param model 
     * @param normalize 
     * @returns 
     */
    static modelToExpr(model: any, column: string, normalize?: boolean): string {
        if(model.operator) { // AND or OR
            return &#x60;${this.makeExpr(model.condition1, column, normalize)} ${model.operator} ${this.makeExpr(model.condition2, column, normalize)}&#x60;;
        }
        else {
            return this.makeExpr(model, column, normalize);
        }
    }

    /**
     * Utility function to convert an ag-grid filter into an
     * equivalent fielded-search string.
     * 
     * For example a filter of type &quot;contains&quot; on the string &quot;toto&quot;
     * is converted to the query &quot;~ toto&quot;
     */
    static makeExpr(filter: Filter, column: string, normalize?: boolean): string {
        let pattern &#x3D; &quot;&quot;;
        if(filter.filterType &#x3D;&#x3D;&#x3D; &quot;text&quot;) {
            let f &#x3D; filter.filter.toString();
            // Normalize entities to avoid ES-13540
            if(normalize) {
                f &#x3D; Utils.normalize(f);
            }
            switch(filter.type) {
                case &quot;contains&quot;: pattern &#x3D; &#x60;~ ${f}&#x60;; break;
                case &quot;notContains&quot;: pattern &#x3D; &#x60;NOT (~ ${f})&#x60;; break;
                case &quot;equals&quot;: pattern &#x3D; &#x60;&#x3D;${ExprParser.escape(f)}&#x60;; break;
                case &quot;notEqual&quot;: pattern &#x3D; &#x60;&lt;&gt;${ExprParser.escape(f)}&#x60;; break;
                case &quot;startsWith&quot;: pattern &#x3D; &#x60; ${ExprParser.escape(f+&quot;*&quot;)}&#x60;; break;
                case &quot;endsWith&quot;: pattern &#x3D; &#x60;~ ${f}$&#x60;; break;
            }
        }
        else if(filter.filterType &#x3D;&#x3D;&#x3D; &quot;number&quot;) {
            switch(filter.type) {
                case &quot;equals&quot;: pattern &#x3D; &#x60;&#x3D;${filter.filter}&#x60;; break;
                case &quot;notEqual&quot;: pattern &#x3D; &#x60;&lt;&gt;${filter.filter}&#x60;; break;
                case &quot;lessThan&quot;: pattern &#x3D; &#x60;&lt;${filter.filter}&#x60;; break;
                case &quot;lessThanOrEqual&quot;: pattern &#x3D; &#x60;&lt;&#x3D;${filter.filter}&#x60;; break;
                case &quot;greaterThan&quot;: pattern &#x3D; &#x60;&gt;${filter.filter}&#x60;; break;
                case &quot;greaterThanOrEqual&quot;: pattern &#x3D; &#x60;&gt;&#x3D;${filter.filter}&#x60;; break;
                case &quot;inRange&quot;: pattern &#x3D; &#x60;[${filter.filter}..${filter.filterTo}]&#x60;; break;
            }
        }
        else if(filter.filterType &#x3D;&#x3D;&#x3D; &quot;date&quot;) {
            switch(filter.type) {
                case &quot;equals&quot;: pattern &#x3D; &#x60;&#x3D;${filter.dateFrom}&#x60;; break;
                case &quot;notEqual&quot;: pattern &#x3D; &#x60;&lt;&gt;${filter.dateFrom}&#x60;; break;
                case &quot;lessThan&quot;: pattern &#x3D; &#x60;&lt;${filter.dateFrom}&#x60;; break;
                case &quot;greaterThan&quot;: pattern &#x3D; &#x60;&gt;${filter.dateFrom}&#x60;; break;
                case &quot;inRange&quot;: pattern &#x3D; &#x60;[${filter.dateFrom}..${filter.dateTo}]&#x60;; break;
            }
        }
        return &#x60;${column}:${pattern}&#x60;;
    }

    /**
     * Convert an expression generated by makeExpr() back into
     * a model that ag-grid can understand
     * @param type 
     * @param column 
     * @param expr 
     */
    static exprToModel(type: &quot;text&quot; | &quot;number&quot; | &quot;date&quot;, column: string, expr: string): any {
        const prefix &#x3D; &#x60;${column}:&#x60;;
        if(expr.startsWith(prefix)) {
            expr &#x3D; expr.substr(prefix.length);

            // Manage operators
            if(expr.includes(&#x60; OR ${prefix}&#x60;)) {
                let [expr1, expr2] &#x3D; expr.split(&#x60; OR ${prefix}&#x60;);
                return {operator: &quot;OR&quot;, condition1: this.subExprToModel(type, expr1), condition2: this.subExprToModel(type, expr2)};
            }
            
            if(expr.includes(&#x60; AND ${prefix}&#x60;)) {
                let [expr1, expr2] &#x3D; expr.split(&#x60; OR ${prefix}&#x60;);
                return {operator: &quot;AND&quot;, condition1: this.subExprToModel(type, expr1), condition2: this.subExprToModel(type, expr2)};
            }
            
            return this.subExprToModel(type, expr);
        }
    }

    static subExprToModel(type: &quot;text&quot; | &quot;number&quot; | &quot;date&quot;, expr: string): any {
        if(type &#x3D;&#x3D;&#x3D; &quot;text&quot;) {
            if(expr.startsWith(&quot;~ &quot;) &amp;&amp; !expr.endsWith(&quot;$&quot;)) return {filterType: &quot;text&quot;, type: &quot;contains&quot;, filter: expr.substr(2)};
            if(expr.startsWith(&quot;NOT (~ &quot;)) return {filterType: &quot;text&quot;, type: &quot;notContains&quot;, filter: expr.substring(7, expr.length-1)};
            if(expr.startsWith(&quot;&#x3D;&#x60;&quot;)) return {filterType: &quot;text&quot;, type: &quot;equals&quot;, filter: ExprParser.unescape(expr.substr(1))};
            if(expr.startsWith(&quot;&lt;&gt;&#x60;&quot;)) return {filterType: &quot;text&quot;, type: &quot;notEqual&quot;, filter: ExprParser.unescape(expr.substr(2))};
            if(expr.startsWith(&quot; &#x60;&quot;)) {
                const filter &#x3D; ExprParser.unescape(expr.substring(1));
                return {filterType: &quot;text&quot;, type: &quot;startsWith&quot;, filter: filter.substring(0,filter.length-1)}; // Remove the &#x27;*&#x27; at the end
            };
            if(expr.startsWith(&quot;~ &quot;) &amp;&amp; expr.endsWith(&quot;$&quot;)) return {filterType: &quot;text&quot;, type: &quot;endsWith&quot;, filter: expr.substring(2, expr.length-1)};
        }
        else if(type &#x3D;&#x3D;&#x3D; &quot;number&quot;) {
            if(expr.startsWith(&quot;&#x3D;&quot;)) return {filterType: &quot;number&quot;, type: &quot;equals&quot;, filter: +expr.substr(1)};
            if(expr.startsWith(&quot;&lt;&gt;&quot;)) return {filterType: &quot;number&quot;, type: &quot;notEqual&quot;, filter: +expr.substr(2)};
            if(expr.startsWith(&quot;&lt;&#x3D;&quot;)) return {filterType: &quot;number&quot;, type: &quot;lessThanOrEqual&quot;, filter: +expr.substr(2)};
            if(expr.startsWith(&quot;&lt;&quot;)) return {filterType: &quot;number&quot;, type: &quot;lessThan&quot;, filter: +expr.substr(1)};
            if(expr.startsWith(&quot;&gt;&#x3D;&quot;)) return {filterType: &quot;number&quot;, type: &quot;greaterThanOrEqual&quot;, filter: +expr.substr(2)};
            if(expr.startsWith(&quot;&gt;&quot;)) return {filterType: &quot;number&quot;, type: &quot;greaterThan&quot;, filter: +expr.substr(1)};
            if(expr.startsWith(&quot;[&quot;) &amp;&amp; expr.includes(&quot;..&quot;) &amp;&amp; expr.endsWith(&quot;]&quot;)) {
                let range &#x3D; expr.substring(1, expr.length-1).split(&quot;..&quot;);
                return {filterType: &quot;number&quot;, type: &quot;inRange&quot;, filter: +range[0], filterTo: +range[1]};
            }
        }
        else if(type &#x3D;&#x3D;&#x3D; &quot;date&quot;) {
            if(expr.startsWith(&quot;&#x3D;&quot;)) return {filterType: &quot;date&quot;, type: &quot;equals&quot;, dateFrom: expr.substr(1)};
            if(expr.startsWith(&quot;&lt;&gt;&quot;)) return {filterType: &quot;date&quot;, type: &quot;notEqual&quot;, dateFrom: expr.substr(2)};
            if(expr.startsWith(&quot;&lt;&quot;)) return {filterType: &quot;date&quot;, type: &quot;lessThan&quot;, dateFrom: expr.substr(1)};
            if(expr.startsWith(&quot;&gt;&quot;)) return {filterType: &quot;date&quot;, type: &quot;greaterThan&quot;, dateFrom: expr.substr(1)};
            if(expr.startsWith(&quot;[&quot;) &amp;&amp; expr.includes(&quot;..&quot;) &amp;&amp; expr.endsWith(&quot;]&quot;)) {
                let range &#x3D; expr.substring(1, expr.length-1).split(&quot;..&quot;);
                return {filterType: &quot;date&quot;, type: &quot;inRange&quot;, dateFrom: range[0], dateTo: range[1]};
            }
        }
        console.error(&quot;Could not rebuild filter from expression: &quot;, expr, type);
        return undefined;
    }

}</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'class';
            var COMPODOC_CURRENT_PAGE_URL = 'SqDatasource.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
